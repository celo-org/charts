# kong-celo-fullnode

Chart wrapper over celo-fullnode chart to adapt to Forno. It requires a Kong controller, kong ingressClass and kong crds installed in the cluster, and creates the Kong consumers, plugins and rate limits.

![Version: 0.5.6](https://img.shields.io/badge/Version-0.5.6-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: 1.0](https://img.shields.io/badge/AppVersion-1.0-informational?style=flat-square)

- [kong-celo-fullnode](#kong-celo-fullnode)
  - [Chart requirements](#chart-requirements)
  - [Chart releases](#chart-releases)
  - [Basic chart operation](#basic-chart-operation)
  - [Values](#values)

## Chart requirements

- Tested with Kubernetes 1.24
- Tested with Helm v3.9.4

## Chart releases

Chart is released to oci://us-west1-docker.pkg.dev/celo-testnet/clabs-public-oci/kong-celo-fullnode repository automatically every commit to `main` branch.
Just remind yourself to bump the version of the chart in the [Chart.yaml](./Chart.yaml) file.
This process is configured using GitHub Actions in the [helm_release.yml](../../.github/workflows/helm_release.yml)
and [helm_test.yml](../../.github/workflows/helm_test.yml) files.

## Basic chart operation

The chart is a wrapper over the [celo-fullnode](../celo-fullnode) chart, adding kong's plugins and clients to rate limit different users.

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| auth.enabled | bool | `true` | Enable auth plugin. Remind to change celo_fullnode.ingress.annotations.konghq.com/plugins to reflect the changes |
| celo_fullnode | object | `{"gcp":true,"genesis":{"network":"rc1","networkId":42220},"geth":{"flags":"--txpool.nolocals","gcmode":"full","image":{"imagePullPolicy":"IfNotPresent","repository":"us.gcr.io/celo-org/geth","tag":"1.8.8"},"node_keys":[],"public_ip_per_node":[],"resources":{"requests":{"cpu":"4","memory":"8Gi"}},"syncmode":"full","verbosity":2,"ws_port":8545},"ingress":{"annotations":{"cert-manager.io/cluster-issuer":"letsencrypt-prod","konghq.com/plugins":"forno-rate-limit, forno-auth","konghq.com/strip-path":"true","kubernetes.io/tls-acme":"true"},"enabled":false,"hosts":["forno.celo-testnet.org"],"ingressClassName":"kong","tls":[{"hosts":["forno.celo-testnet.org"],"secretName":"forno.celo-testnet.org-tls"}]},"metrics":true,"pprof":{"enabled":true,"path":"/debug/metrics/prometheus","port":6060},"replicaCount":2,"storage":{"accessModes":"ReadWriteOnce","autoscaling":{"behavior":{"scaleDown":{"policies":[{"periodSeconds":60,"type":"Pods","value":2},{"periodSeconds":60,"type":"Percent","value":25}],"selectPolicy":"Max","stabilizationWindowSeconds":1800},"scaleUp":{"policies":[{"periodSeconds":15,"type":"Pods","value":2},{"periodSeconds":15,"type":"Percent","value":25}],"selectPolicy":"Max","stabilizationWindowSeconds":600}},"enabled":false,"maxReplicas":5,"metrics":[{"resource":{"name":"cpu","target":{"averageUtilization":85,"type":"Utilization"}},"type":"Resource"}],"minReplicas":1},"enable":true,"size":"100Gi","snapshot":{"enabled":false,"kind":"VolumeSnapshot","name":"forno-snapshot"},"storageClass":"premium-rwo"}}` | Check values at [celo-fullnode chart](../celo-fullnode/README.md) |
| consumers | list | `["odis","mento","foundation"]` | List of consumers to create in Kong (each consumer is a different client with different credentials) |
| rate_limit.enabled | bool | `true` | Enable rate limit plugin. Remind to change celo_fullnode.ingress.annotations.konghq.com/plugins to reflect the changes |
| rate_limit.limit_by | string | `"consumer"` | The entity that will be used when aggregating the limits |
| rate_limit.limits | object | `{"hour":100000}` | Rate limit configuration for each client |
| rate_limit.limits.hour | int | `100000` | Number of requests per hour allowed for each consumer |
| redisPassword | string | `"changeme"` | Redis password. Redis is used for storing rate limit counters |

----------------------------------------------
Autogenerated from chart metadata using [helm-docs](https://github.com/norwoodj/helm-docs). To regenerate run `helm-docs` command at this folder.
